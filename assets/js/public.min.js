/*! WP Simple Pay Lite for Stripe - 2.0.8
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2018
 * Licensed GPLv2+ */

var simpayApp={};!function(i){"use strict";var s;simpayApp={spFormElList:{},spFormData:{},spStripeData:{},init:function(){s=i(document.body),this.spFormElList=s.find(".simpay-checkout-form"),this.spFormElList.each(function(){var n=i(this);simpayApp.processForm(n),s.trigger("simpayProcessFormElements",[n])}),s.trigger("simpayLoaded")},processForm:function(n){var e=n.data("simpay-form-id"),a=simplePayForms[e],t=this.spFormData[e],r=null;(t=i.extend({},a.form.integers,a.form.bools,a.form.strings)).formId=e,t.finalAmount=t.amount,t.quantity=1,t.stripeParams=i.extend({},a.stripe.strings,a.stripe.bools),t.oldPanelLabel=void 0!==t.stripeParams.panelLabel?t.stripeParams.panelLabel:"",s.trigger("simpayFormVarsInitialized",[n,t]),r=StripeCheckout.configure({key:t.stripeParams.key,token:function(i,s){n.find(".simpay-stripe-token").val(i.id),n.find(".simpay-stripe-email").val(i.email),simpayApp.handleStripeArgs(n,s),n.find(".simpay-payment-btn").prop("disabled",!0).find("span").text(t.loadingText),n.unbind("submit",[n,t]),n.submit()},opened:function(){},closed:function(){}});n.find(".simpay-payment-btn").on("click.simpayPaymentBtn",function(i){i.preventDefault(),n.trigger("simpayBeforeStripePayment",[n,t]),simpayApp.submitPayment(n,t,r)}),this.spFormData[e]=t,s.trigger("simpayBindEventsAndTriggers",[n,t])},handleStripeArgs:function(i,s){s.shipping_name&&i.find(".simpay-shipping-name").val(s.shipping_name),s.shipping_address_country&&i.find(".simpay-shipping-country").val(s.shipping_address_country),s.shipping_address_zip&&i.find(".simpay-shipping-zip").val(s.shipping_address_zip),s.shipping_address_state&&i.find(".simpay-shipping-state").val(s.shipping_address_state),s.shipping_address_line1&&i.find(".simpay-shipping-address-line1").val(s.shipping_address_line1),s.shipping_address_city&&i.find(".simpay-shipping-city").val(s.shipping_address_city)},submitPayment:function(i,n,e){simpayApp.setFinalAmount(i,n),n.stripeParams.amount=parseInt(n.finalAmount),i.valid()&&(s.trigger("simpaySubmitPayment",[i,n]),spShared.debugLog("stripeParams",n.stripeParams),e.open(n.stripeParams))},setFinalAmount:function(i,n){var e=n.amount;n.finalAmount=e.toFixed(0),s.trigger("simpayFinalizeAmount",[i,n]),i.find(".simpay-amount").val(n.finalAmount)},formatMoney:function(i){var s,n="%s%v";return i=simpayApp.convertFromCents(i),"left_space"===spGeneral.strings.currencyPosition?n="%s %v":"right"===spGeneral.strings.currencyPosition?n="%v%s":"right_space"===spGeneral.strings.currencyPosition&&(n="%v %s"),s={symbol:spGeneral.strings.currencySymbol,decimal:spGeneral.strings.decimalSeparator,thousand:spGeneral.strings.thousandSeparator,precision:spGeneral.integers.decimalPlaces,format:n},accounting.formatMoney(i,s)},convertFromCents:function(i){return spGeneral.booleans.isZeroDecimal?i:(i/100).toFixed(2)},convertToCents:function(i){return spGeneral.booleans.isZeroDecimal?i:100*i}},i(document).ready(function(i){simpayApp.init()})}(jQuery);
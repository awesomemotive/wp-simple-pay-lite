/*! WP Simple Pay Lite for Stripe - 2.0.4
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media 2017
 * Licensed GPLv2+ */

var simpayApp={};!function(a){"use strict";var b=a(document.body);simpayApp={spFormElList:{},spFormData:{},spStripeData:{},init:function(){this.spFormElList=b.find(".simpay-checkout-form"),this.spFormElList.each(function(){var c=a(this);simpayApp.processForm(c),b.trigger("simpayProcessFormElements",[c])}),b.trigger("simpayLoaded")},processForm:function(c){function d(a,b){c.find(".simpay-stripe-token").val(a.id),c.find(".simpay-stripe-email").val(a.email),simpayApp.handleStripeArgs(c,b),c.find(".simpay-payment-btn").prop("disabled",!0).find("span").text(g.loadingText),c.unbind("submit",[c,g]),c.submit()}var e=c.data("simpay-form-id"),f=simplePayForms[e],g=this.spFormData[e],h=null;g=a.extend({},f.form.integers,f.form.bools,f.form.strings),g.formId=e,g.finalAmount=g.amount,g.quantity=1,g.stripeParams=a.extend({},f.stripe.strings,f.stripe.bools),g.oldPanelLabel=void 0!==g.stripeParams.panelLabel?g.stripeParams.panelLabel:"",b.trigger("simpayFormVarsInitialized",[c,g]),h=StripeCheckout.configure({key:g.stripeParams.key,token:d,opened:function(){},closed:function(){}}),c.find(".simpay-payment-btn").on("click.simpayPaymentBtn",function(a){a.preventDefault(),c.trigger("simpayBeforeStripePayment",[c,g]),simpayApp.submitPayment(c,g,h)}),this.spFormData[e]=g,b.trigger("simpayBindEventsAndTriggers",[c,g])},handleStripeArgs:function(a,b){b.shipping_name&&a.find(".simpay-shipping-name").val(b.shipping_name),b.shipping_address_country&&a.find(".simpay-shipping-country").val(b.shipping_address_country),b.shipping_address_zip&&a.find(".simpay-shipping-zip").val(b.shipping_address_zip),b.shipping_address_state&&a.find(".simpay-shipping-state").val(b.shipping_address_state),b.shipping_address_line1&&a.find(".simpay-shipping-address-line1").val(b.shipping_address_line1),b.shipping_address_city&&a.find(".simpay-shipping-city").val(b.shipping_address_city)},submitPayment:function(a,c,d){simpayApp.setFinalAmount(a,c),c.stripeParams.amount=parseInt(c.finalAmount),a.valid()&&(b.trigger("simpaySubmitPayment",[a,c]),spShared.debugLog("stripeParams",c.stripeParams),d.open(c.stripeParams))},setFinalAmount:function(a,c){var d=c.amount;c.finalAmount=d.toFixed(0),b.trigger("simpayFinalizeAmount",[a,c]),a.find(".simpay-amount").val(c.finalAmount)},formatMoney:function(a){var b,c="%s%v";return a=simpayApp.convertFromCents(a),"left_space"===spGeneral.strings.currencyPosition?c="%s %v":"right"===spGeneral.strings.currencyPosition?c="%v%s":"right_space"===spGeneral.strings.currencyPosition&&(c="%v %s"),b={symbol:spGeneral.strings.currencySymbol,decimal:spGeneral.strings.decimalSeparator,thousand:spGeneral.strings.thousandSeparator,precision:spGeneral.integers.decimalPlaces,format:c},accounting.formatMoney(a,b)},convertFromCents:function(a){return spGeneral.booleans.isZeroDecimal?a:(a/100).toFixed(2)},convertToCents:function(a){return spGeneral.booleans.isZeroDecimal?a:100*a}},a(document).ready(function(a){spShared.debugLog("before simpayApp.init"),simpayApp.init(),spShared.debugLog("after simpayApp.init")})}(jQuery);
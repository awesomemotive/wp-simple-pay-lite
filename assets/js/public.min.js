/*! WP Simple Pay Lite for Stripe - 2.0.12
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2018
 * Licensed GPLv2+ */

var simpayApp={};!function(t){"use strict";var r;simpayApp={spFormElList:{},spFormData:{},spStripeData:{},init:function(){r=t(document.body),this.spFormElList=r.find(".simpay-checkout-form"),this.spFormElList.each(function(){var i=t(this);simpayApp.processForm(i),r.trigger("simpayProcessFormElements",[i])}),r.trigger("simpayLoaded")},processForm:function(n){var s,i=n.data("simpay-form-id"),e=simplePayForms[i],a=this.spFormData[i];(a=t.extend({},e.form.integers,e.form.bools,e.form.strings)).formId=i,a.finalAmount=a.amount,a.quantity=1,a.stripeParams=t.extend({},e.stripe.strings,e.stripe.bools),a.oldPanelLabel=void 0!==a.stripeParams.panelLabel?a.stripeParams.panelLabel:"",r.trigger("simpayFormVarsInitialized",[n,a]),s=StripeCheckout.configure({key:a.stripeParams.key,token:function(i,s){n.find(".simpay-stripe-token").val(i.id),n.find(".simpay-stripe-email").val(i.email),simpayApp.handleStripeArgs(n,s),n.find(".simpay-payment-btn").prop("disabled",!0).find("span").text(a.loadingText),n.unbind("submit",[n,a]),n.submit()},opened:function(){},closed:function(){}}),n.find(".simpay-payment-btn").on("click.simpayPaymentBtn",function(i){i.preventDefault(),n.trigger("simpayBeforeStripePayment",[n,a]),simpayApp.submitPayment(n,a,s)}),this.spFormData[i]=a,r.trigger("simpayBindEventsAndTriggers",[n,a])},handleStripeArgs:function(i,s){s.shipping_name&&i.find(".simpay-shipping-name").val(s.shipping_name),s.shipping_address_country&&i.find(".simpay-shipping-country").val(s.shipping_address_country),s.shipping_address_zip&&i.find(".simpay-shipping-zip").val(s.shipping_address_zip),s.shipping_address_state&&i.find(".simpay-shipping-state").val(s.shipping_address_state),s.shipping_address_line1&&i.find(".simpay-shipping-address-line1").val(s.shipping_address_line1),s.shipping_address_city&&i.find(".simpay-shipping-city").val(s.shipping_address_city)},submitPayment:function(i,s,n){simpayApp.setFinalAmount(i,s),s.stripeParams.amount=parseInt(s.finalAmount),i.valid()&&(r.trigger("simpaySubmitPayment",[i,s]),spShared.debugLog("stripeParams",s.stripeParams),n.open(s.stripeParams))},setFinalAmount:function(i,s){var n=s.amount;s.finalAmount=n.toFixed(0),r.trigger("simpayFinalizeAmount",[i,s]),i.find(".simpay-amount").val(s.finalAmount)},formatMoney:function(i){var s,n="%s%v";return i=simpayApp.convertFromCents(i),"left_space"===spGeneral.strings.currencyPosition?n="%s %v":"right"===spGeneral.strings.currencyPosition?n="%v%s":"right_space"===spGeneral.strings.currencyPosition&&(n="%v %s"),s={symbol:spGeneral.strings.currencySymbol,decimal:spGeneral.strings.decimalSeparator,thousand:spGeneral.strings.thousandSeparator,precision:spGeneral.integers.decimalPlaces,format:n},accounting.formatMoney(i,s)},convertFromCents:function(i){return spGeneral.booleans.isZeroDecimal?i:(i/100).toFixed(2)},convertToCents:function(i){return spGeneral.booleans.isZeroDecimal?i:(100*i).toFixed(2)}},t(document).ready(function(i){simpayApp.init()})}(jQuery);
/*! WP Simple Pay Lite for Stripe - 2.1.1
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2019
 * Licensed GPLv2+ */

var simpayApp={};!function(t){"use strict";var e;simpayApp={spFormElList:{},spFormData:{},init:function(){e=t(document.body),simpayApp.spFormElList=e.find(".simpay-checkout-form"),simpayApp.spFormElList.each(function(){var i=t(this);simpayApp.setupCoreForm(i),e.trigger("simpaySetupCoreForm",[i])})},isStripeCheckoutForm:function(i){return void 0===i.formDisplayType||"stripe_checkout"===i.formDisplayType},setupCoreForm:function(i){var p=i.data("simpay-form-id"),s=simplePayForms[p],n=t.extend({},s.form.bools,s.form.integers,s.form.i18n,s.form.strings);n.formId=p,n.finalAmount=n.amount,n.quantity=1,n.stripeParams=t.extend({},s.stripe.strings,s.stripe.bools),n.oldPanelLabel=void 0!==n.stripeParams.panelLabel?n.stripeParams.panelLabel:"",n.submitBtnClass="simpay-payment-btn",e.trigger("simpayCoreFormVarsInitialized",[i,n]),simpayApp.isStripeCheckoutForm(n)&&simpayApp.setupStripeCheckout(i,n),simpayApp.spFormData[p]=n,e.trigger("simpayBindCoreFormEventsAndTriggers",[i,n])},setupStripeCheckout:function(n,e){var i=n.find("."+e.submitBtnClass),p=null;i.length&&(p=StripeCheckout.configure({key:e.stripeParams.key,token:function(i,p){!function(i,p){var s=n.find("."+e.submitBtnClass);t("<input>").attr({type:"hidden",name:"simpay_stripe_token",value:i.id}).appendTo(n),t("<input>").attr({type:"hidden",name:"simpay_stripe_email",value:i.email}).appendTo(n),p&&simpayApp.handleStripeShippingArgs(n,p);s.prop("disabled",!0).find("span").text(e.loadingText),n.off("submit"),n.submit()}(i,p)},opened:function(){},closed:function(){}})),n.on("submit",function(i){i.preventDefault(),e.isValid=!0,n.trigger("simpayBeforeStripePayment",[n,e]),e.isValid&&(simpayApp.setCoreFinalAmount(n,e),e.stripeParams.amount=spShared.convertToCents(e.finalAmount),n.find(".simpay-amount").val(e.stripeParams.amount),p.open(e.stripeParams))})},handleStripeShippingArgs:function(i,p){p.shipping_name&&i.find(".simpay-shipping-name").val(p.shipping_name),p.shipping_address_country&&i.find(".simpay-shipping-country").val(p.shipping_address_country),p.shipping_address_zip&&i.find(".simpay-shipping-zip").val(p.shipping_address_zip),p.shipping_address_state&&i.find(".simpay-shipping-state").val(p.shipping_address_state),p.shipping_address_line1&&i.find(".simpay-shipping-address-line1").val(p.shipping_address_line1),p.shipping_address_city&&i.find(".simpay-shipping-city").val(p.shipping_address_city)},setCoreFinalAmount:function(i,p){p.finalAmount=p.amount,e.trigger("simpayFinalizeCoreAmount",[i,p])}},t(document).ready(function(i){simpayApp.init()})}(jQuery);
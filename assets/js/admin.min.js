/*! WP Simple Pay Lite for Stripe - 2.0.12
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2019
 * Licensed GPLv2+ */

var spAdmin={};!function(s){"use strict";var t,n;spAdmin={init:function(){t=s(document.body),n=t.find("#simpay-form-settings"),this.setupChosen(),this.addMediaFields(),this.handleMetaboxTabClick(),this.stripeConnect(),n.on("click.simpayTabLink",".simpay-tab-link",function(i){i.preventDefault(),spAdmin.handleInternalLinkToTabClicks(s(this))}),n.on("click.simpayImagePreview",".simpay-remove-image-preview",function(i){spAdmin.handleRemoveImagePreviewClick(i)}),n.find(".simpay-panel-field").on("change.simpaySectionToggle",".simpay-section-toggle",function(i){spAdmin.initSectionToggle(s(this))}),t.find(".simpay-button").on("click.simpayShowSpinner",function(i){spAdmin.showSpinner(s(this))}),t.find("#simpay-preview-button").on("click.simpayPreviewButton",function(i){spAdmin.handlePreviewButton(s(this),i)}),t.find("#post").on("keypress.simpaySubmitOnEnter",function(i){spAdmin.handleSubmitOnEnter(s(this),i)}),n.find('.simpay-multi-toggle input[type="radio"]:checked').each(function(){spAdmin.initMultiToggle(s(this))}),n.on("change.simpayMultiToggle",'.simpay-multi-toggle input[type="radio"]',function(){spAdmin.initMultiToggle(s(this))}),t.find(".simpay-amount-input").trigger("blur.validateAndUpdateAmount"),t.trigger("simpayAdminInit")},handleSubmitOnEnter:function(i,e){var t,n,a;13===(e.keyCode?e.keyCode:e.which)&&(n=(t=i.closest("form")).find("#save-post"),a=t.find("#publish"),0<n.length?n.click():a.click())},handlePreviewButton:function(i,e){var t,n;e.preventDefault(),t=(n=i.closest("form")).attr("action"),n.attr("action",i.data("action")),n.attr("target","_blank"),n.submit(),n.attr("action",t),n.attr("target","")},showSpinner:function(i){i.parent().find(".spinner").css("visibility","visible")},handleRemoveImagePreviewClick:function(i){i.preventDefault(),n.find(".simpay-image-preview-wrap").hide(),n.find("#_image_url").val("")},addMediaFields:function(){var n;s(".simpay-media-uploader").on("click",function(i){i.preventDefault(),window.simpayMediaUploaderInputField=s(this),n||(n=wp.media.frames.file_frame=wp.media({title:spGeneral.i18n.mediaTitle,button:{text:spGeneral.i18n.mediaButtonText},multiple:!1})).on("select",function(){var i=n.state().get("selection").first().toJSON(),e=window.simpayMediaUploaderInputField.prev(),t="id"===e.data("fvalue")?i.id:i.url;s(".simpay-image-preview-wrap").show(),s(".simpay-image-preview").prop("src",t),e.val(t)}),n.open()})},setupChosen:function(){var i=s(".simpay-chosen-select, .simpay-chosen-search");i.chosen({disable_search_threshold:20}),i.chosen()},handleMetaboxTabClick:function(){var i=s("ul.simpay-tabs a"),n=s("div.simpay-panel"),a=i.parents("li"),e={};i.on("click",function(i){var e=s(this).parent(),t=s(s(this).attr("href"));location.hash=s(this).attr("href"),i.preventDefault(),a.removeClass("active"),e.addClass("active"),n.addClass("simpay-panel-hidden"),t.removeClass("simpay-panel-hidden"),i.stopPropagation()}),location.hash.length&&(setTimeout(function(){window.scrollTo(0,0)},1),(e=s('ul.simpay-tabs a[href="'+location.hash+'"]')).length&&e.click())},stripeConnect:function(){s("#simpay-settings-keys-mode-test-mode").closest(".form-table").next().hide().next().hide(),s("#wpsp-api-keys-row-reveal a").click(function(){s("#simpay-settings-keys-mode-test-mode").closest(".form-table").next().show().next().show(),s("#wpsp-api-keys-row-hide").show(),s(this).parent().hide()}),s("#wpsp-api-keys-row-hide a").click(function(){s("#simpay-settings-keys-mode-test-mode").closest(".form-table").next().hide().next().hide(),s("#wpsp-api-keys-row-reveal").show(),s(this).parent().hide()})},handleInternalLinkToTabClicks:function(i){var e=i.data("show-tab");t.find("."+e+"-tab a").click()},initSectionToggle:function(i){var e=i.data("show");i.is(":checked")?i.closest(".simpay-panel-field").parent().find(e).show():i.closest(".simpay-panel-field").parent().find(e).hide()},initMultiToggle:function(i){var e=i.attr("id");i.closest(".simpay-field-radios-inline").find('input[type="radio"]').each(function(i){n.find(".toggle-"+s(this).attr("id")).hide()}),n.find(".toggle-"+e).show()}},s(document).ready(function(i){spAdmin.init()})}(jQuery);